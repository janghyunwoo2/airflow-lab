# 6\. ETL ì¢…í•© ì‹¤ìŠµ (Extract â†’ Transform â†’ Load)

## ğŸ¯ ì´ ì‹¤ìŠµì˜ ëª©í‘œ

- ETL(Extract / Transform / Load) íë¦„ì„ DAGë¡œ í‘œí˜„í•œë‹¤
- TaskFlow API ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° íë¦„ì„ êµ¬ì„±í•œë‹¤
- ì¡°ê±´ì— ë”°ë¼ ETLì„ **ì‹¤í–‰/ì¤‘ë‹¨**í•˜ëŠ” ì œì–´ ë¡œì§ì„ ë„£ëŠ”ë‹¤
- ë¡œê·¸ë¥¼ í†µí•´ **ì‹¤í–‰ íë¦„ì„ ì¶”ì **í•œë‹¤

* * *

## ğŸ”– ETL íŒŒì´í”„ë¼ì¸ ê°œìš”

```text
start
  â†“
extract
  â†“
check_data (ShortCircuit)
  â†“
transform
  â†“
load
  â†“
end
```

* * *

## ğŸ“ ì‹¤ìŠµ íŒŒì¼ ì •ë³´

**íŒŒì¼ëª…: `dags/06_etl_pipeline_lab.py`**

- `schedule=None`
- `catchup=False`
- `tags=["example", "tutorial", "etl"]`

* * *

## ğŸ§ª ETL ì¢…í•© ì‹¤ìŠµ ì½”ë“œ

```python
from __future__ import annotations

from airflow.decorators import dag, task
from airflow.operators.python import ShortCircuitOperator
from airflow.operators.empty import EmptyOperator
from airflow.utils.log.logging_mixin import LoggingMixin
from datetime import datetime
from typing import List

log = LoggingMixin().log

@dag(
    dag_id="etl_pipeline_lab",
    start_date=datetime(2024, 1, 1),
    schedule=None,
    catchup=False,
    tags=["example", "tutorial", "etl"],
)
def etl_pipeline_lab():
    start = EmptyOperator(task_id="start")

    @task
    def extract() -> List[int]:
        data = [1, 2, 3, 4, 5]
        log.info("Extracted data: %s", data)
        return data

    def has_data(data: List[int], **context) -> bool:
        log.info("Checking data length: %d", len(data))
        return len(data) > 0

    check_data = ShortCircuitOperator(
        task_id="check_data",
        python_callable=has_data,
        op_args=[extract()],
    )

    @task
    def transform(data: List[int]) -> List[int]:
        result = [x * 10 for x in data]
        log.info("Transformed data: %s", result)
        return result

    @task
    def load(result: List[int]) -> None:
        log.info("Loading result: %s", result)

    end = EmptyOperator(task_id="end")

    start >> extract() >> check_data
    check_data >> transform(extract()) >> load(transform(extract())) >> end

etl_pipeline_lab()
```

* * *

## ğŸ” ì‹¤ìŠµ ì¤‘ í™•ì¸ í¬ì¸íŠ¸

1. Graph Viewì—ì„œ ETL íë¦„ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë³´ì´ëŠ”ì§€
2. ê° Task ë¡œê·¸ì— ë°ì´í„°ê°€ ë‹¨ê³„ë³„ë¡œ ì¶œë ¥ë˜ëŠ”ì§€
3. `extract()` ê²°ê³¼ë¥¼ `[]`ë¡œ ë°”ê¿¨ì„ ë•Œ
    - `transform`, `load`ê°€ `skipped` ë˜ëŠ”ì§€

* * *

## âš ï¸ í”í•œ ì‹¤ìˆ˜ì™€ ì˜ëª»ëœ ì½”ë“œ ì˜ˆì‹œ

ì•„ë˜ëŠ” **ì‹¤ì œ ì‹¤ìŠµ ì¤‘ ìì£¼ ë°œìƒí•˜ëŠ” ì‹¤ìˆ˜ë“¤**ì´ë‹¤.

* * *

### âŒ ì‹¤ìˆ˜ 1: DAG ì •ì˜ë¶€ì—ì„œ ë°ì´í„°ë¥¼ ì§ì ‘ ê³„ì‚°

```python
data = [x * 10 for x in range(1000000)]

@task
def transform():
    return data
```

- DAG íŒŒì‹± ì‹œì ì— ì½”ë“œê°€ ì‹¤í–‰ë¨
- DAG Processor / Scheduler ë¶€í•˜ ì¦ê°€

* * *

### âŒ ì‹¤ìˆ˜ 2: `extract()`ë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œ

```python
check_data = ShortCircuitOperator(
    task_id="check_data",
    python_callable=has_data,
    op_args=[extract()],
)

transform(extract())
load(transform(extract()))
```

- í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ Task ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- Graph êµ¬ì¡°ê°€ ê¼¬ì„

* * *

### âŒ ì‹¤ìˆ˜ 3: ShortCircuitê³¼ Branch í˜¼ë™

```python
gate = ShortCircuitOperator(...)
```

- False â†’ ì´í›„ ëª¨ë“  downstream Taskê°€ skipped

* * *

### âŒ ì‹¤ìˆ˜ 4: ë¡œê·¸ ëŒ€ì‹  print ì‚¬ìš©

```python
print("data:", data)
```

- ë¡œê·¸ ë ˆë²¨ ê´€ë¦¬ ë¶ˆê°€
- ìš´ì˜ í™˜ê²½ ë¡œê·¸ ë¶„ì„ì— ë¶€ì í•©

* * *

### âŒ ì‹¤ìˆ˜ 5: start\_dateë¥¼ í˜„ì¬ ì‹œê°ìœ¼ë¡œ ì„¤ì •

```python
start_date=datetime.now()
```

- Scheduler íƒ€ì´ë°ì— ë”°ë¼ DAG ë¯¸ì‹¤í–‰ ê°€ëŠ¥

<br>